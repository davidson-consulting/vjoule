<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>python - vJoule doc</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Documentation for vJoule.">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="../">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        
        <link rel="stylesheet" href="custom.css">
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li><a href="./home/index.html"><strong>1.</strong> Home</a></li><li><a href="./getting_started/index.html"><strong>2.</strong> Getting started</a></li><li><ul class="section"><li><a href="./getting_started/what_is_vjoule.html"><strong>2.1.</strong> What is vJoule?</a></li><li><a href="./getting_started/installation.html"><strong>2.2.</strong> Installation</a></li><li><a href="./getting_started/first_tests.html"><strong>2.3.</strong> First tests</a></li></ul></li><li><a href="./user_guide/index.html"><strong>3.</strong> User Guide</a></li><li><ul class="section"><li><a href="./user_guide/cgroups.html"><strong>3.1.</strong> cgroups</a></li><li><a href="./user_guide/directories_layout.html"><strong>3.2.</strong> Config files, logs and results</a></li><li><a href="./user_guide/divider_core.html"><strong>3.3.</strong> The divider core</a></li><li><a href="./user_guide/dumping_core.html"><strong>3.4.</strong> The dumper core</a></li><li><a href="./user_guide/sensor_plugins.html"><strong>3.5.</strong> Sensor plugins</a></li><li><a href="./user_guide/pullers.html"><strong>3.6.</strong> Fetching results with pullers</a></li></ul></li><li><a href="./cli/index.html"><strong>4.</strong> vjoule CLI</a></li><li><ul class="section"><li><a href="./cli/exec.html"><strong>4.1.</strong> vjoule exec</a></li><li><a href="./cli/profile.html"><strong>4.2.</strong> vjoule profile</a></li><li><a href="./cli/top.html"><strong>4.3.</strong> vjoule top</a></li></ul></li><li><a href="./api/index.html"><strong>5.</strong> API</a></li><li><ul class="section"><li><a href="./api/rust.html"><strong>5.1.</strong> rust</a></li><li><a href="./api/py.html" class="active"><strong>5.2.</strong> python</a></li></ul></li><li><a href="./tutorial/index.html"><strong>6.</strong> Tutorials</a></li><li><ul class="section"><li><a href="./tutorial/mesuring.html"><strong>6.1.</strong> Measuring a program</a></li></ul></li><li><a href="./troubleshooting/index.html"><strong>7.</strong> Trouble-shooting</a></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars" title="Toggle sidebar"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush" title="Change theme"></i>
                    </div>

                    <h1 class="menu-title">vJoule doc</h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="./api/py.html#vjoule-api-python" id="vjoule-api-python"><h1>vJoule API python</h1></a>
<p>The vJoule API for python is accessible from the source repository of vJoule.</p>
<a class="header" href="./api/py.html#installation" id="installation"><h2>Installation</h2></a>
<p>The installation is made using a local pip install.</p>
<pre><code class="language-bash">git clone https://github.com/davidson-consulting/vjoule.git
cd vjoule/tools/api/py/src/
pip install .
</code></pre>
<p>Here is a simple example using the installed API.</p>
<pre><code class="language-python">from vjoule_api_py.vjoule_api import *

def computePi(prec):
    res = 0
    for i in range(prec):
        i_prec = 1.0 / prec
        res += (4.0 / prec) / (1.0 + ((i - 0.5) * i_prec) * ((i - 0.5) * i_prec))
    return res


api = VJouleAPI ()
pg = api.getGroup (&quot;this&quot;)

m_beg = api.getCurrentMachineConsumption ()
p_beg = pg.getCurrentConsumption ()
    
pi = computePi (10000000)

m_end = api.getCurrentMachineConsumption ()
p_end = pg.getCurrentConsumption ()

m_diff = m_end - m_beg
p_diff = p_end - p_beg

print (&quot;PI : &quot;, pi)
print (p_diff)
print (m_diff)
print (p_diff % m_diff)

api.dispose ()
</code></pre>
<a class="header" href="./api/py.html#permissions" id="permissions"><h2>Permissions</h2></a>
<p>This API uses the vjoule tool <code>vjoule_cgutils</code> that can be executed
only by user from the user group <code>vjoule</code>. To be part of this group,
the user alice has to type the following command.</p>
<pre><code class="language-bash">$ usermod -a -G vjoule alice
</code></pre>
<a class="header" href="./api/py.html#usage" id="usage"><h2>Usage</h2></a>
<p>The API is base on two important types : <code>VJouleAPI</code> and
<code>ProcessGroup</code>.  The VJouleAPI type is used to manage process group,
and to retreive the consumption of the whole machine, when process
groups are created by the VJouleAPI and are used to retreive the
consumption of a given cgroup.</p>
<p>The rust API uses the vjoule service, to retreive the consumptions of
the components and cgroups. The API communicates with it to avoid
waiting for service iterations to get the the next consumption, as we
have seen in the user guide.</p>
<a class="header" href="./api/py.html#disposing" id="disposing"><h3>Disposing</h3></a>
<p>When the API object is no longer used it has to be disposed, as it
creates cgroups on the system that have to be removed to avoid making
waste material.</p>
<pre><code class="language-python">api = VJouleAPI ()

# ...

api.dispose ()
</code></pre>
<a class="header" href="./api/py.html#create-a-new-process-group" id="create-a-new-process-group"><h3>Create a new process group</h3></a>
<p>The API can be used to create a new cgroup using a list of pids.</p>
<pre><code class="language-python">api = VJouleAPI ()

processGroup = api.createGroup (&quot;my_group&quot;, [123, 234, 345])

begin = processGroup.getCurrentConsumption ()
time.sleep (3) # sleeping 3 seconds
end = processGroup.getCurrentConsumption ()

print (end - begin) # display the consumption during the 3 seconds

# Disposing the API, to remove the created groups
api.dispose () 
</code></pre>
<a class="header" href="./api/py.html#retreive-an-already-created-cgroup" id="retreive-an-already-created-cgroup"><h3>Retreive an already created cgroup</h3></a>
<p>The API can retreive a cgroup that already exists. As for the cgroup
presented to the vjoule service, the cgroup accessible from the API
must be in a slice.</p>
<pre><code class="language-python">api = VJouleAPI ()

processGroup = api.getGroup (&quot;slice/group&quot;)

begin = processGroup.getCurrentConsumption ()
time.sleep (3) # sleeping 3 seconds
end = processGroup.getCurrentConsumption ()

print (end - begin) # display the consumption during the 3 seconds

# Disposing the API, the cgroup is not removed as it was not created by the API
api.dispose () 
</code></pre>
<p>By default, a process group named <code>this</code> is created by the API when it
is initialized <code>api.getGroup (&quot;this&quot;)</code>. This process group contains the
pid of the current process, enabling to retreive the estimated
consumption of the running program.</p>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a rel="prev" href="./api/rust.html" class="mobile-nav-chapters previous" title="Previous chapter">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="./tutorial/index.html" class="mobile-nav-chapters next" title="Next chapter">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="./api/rust.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="./tutorial/index.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        
    <script type="text/javascript">
        var socket = new WebSocket("ws://localhost:3001");
        socket.onmessage = function (event) {
            if (event.data === "reload") {
                socket.close();
                location.reload(true); // force reload from server (not from cache)
            }
        };

        window.onbeforeunload = function() {
            socket.close();
        }
    </script>


        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        
        <script type="text/javascript" src="custom.js"></script>
        

    </body>
</html>
