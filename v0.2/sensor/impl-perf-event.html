<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>class sensor::perf::PerfEventWatcher - vJoule doc</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Documentation for vJoule.">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="../">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        
        <link rel="stylesheet" href="custom.css">
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li><a href="./home/index.html"><strong>1.</strong> Home</a></li><li><a href="./getting_started/index.html"><strong>2.</strong> Getting started</a></li><li><ul class="section"><li><a href="./getting_started/what_is_vjoule.html"><strong>2.1.</strong> What is vJoule?</a></li><li><a href="./getting_started/installation.html"><strong>2.2.</strong> Installation</a></li><li><a href="./getting_started/first_tests.html"><strong>2.3.</strong> First tests</a></li></ul></li><li><a href="./user_guide/index.html"><strong>3.</strong> User Guide</a></li><li><ul class="section"><li><a href="./user_guide/cgroups.html"><strong>3.1.</strong> cgroups</a></li><li><a href="./user_guide/directories_layout.html"><strong>3.2.</strong> Config files, logs and results</a></li><li><a href="./user_guide/pullers.html"><strong>3.3.</strong> Fetching results with pullers</a></li><li><a href="./user_guide/dumping_formula.html"><strong>3.4.</strong> The dumping formula</a></li></ul></li><li><a href="./tutorial/index.html"><strong>4.</strong> Tutorials</a></li><li><ul class="section"><li><a href="./tutorial/mesuring.html"><strong>4.1.</strong> Evaluate a script</a></li><li><a href="./tutorial/mesuring_ws.html"><strong>4.2.</strong> Evaluate a web service</a></li><li><a href="./tutorial/fetch_results.html"><strong>4.3.</strong> Fetching results in a program</a></li></ul></li><li><a href="./api_reference/index.html"><strong>5.</strong> API Reference</a></li><li><ul class="section"><li><a href="./sensor/index.html"><strong>5.1.</strong> Sensor</a></li><li><ul class="section"><li><a href="./sensor/protocol.html"><strong>5.1.1.</strong> protocol</a></li><li><a href="./sensor/impl.html"><strong>5.1.2.</strong> c++ implementation</a></li><li><ul class="section"><li><a href="./sensor/impl-sensor.html"><strong>5.1.2.1.</strong> class sensor::Sensor</a></li><li><a href="./sensor/impl-notif.html"><strong>5.1.2.2.</strong> class sensor::Notifier</a></li><li><a href="./sensor/impl-perf-event.html" class="active"><strong>5.1.2.3.</strong> class sensor::perf::PerfEventWatcher</a></li><li><a href="./sensor/impl-cgroup-lister.html"><strong>5.1.2.4.</strong> class sensor::cgroup::CgroupLister</a></li></ul></li></ul></li><li><a href="./formulas/index.html"><strong>5.2.</strong> Formula</a></li><li><ul class="section"><li><a href="./formulas/simple-formula.html"><strong>5.2.1.</strong> Simple formula</a></li><li><a href="./formulas/smartwatts-formula.html"><strong>5.2.2.</strong> Smartwatts formula</a></li><li><a href="./formulas/implementing-new-formula.html"><strong>5.2.3.</strong> Implementing a new formula</a></li></ul></li><li><a href="./pullers/index.html"><strong>5.3.</strong> Pullers</a></li></ul></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars" title="Toggle sidebar"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush" title="Change theme"></i>
                    </div>

                    <h1 class="menu-title">vJoule doc</h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="./sensor/impl-perf-event.html#class-sensorperfperfeventwatcher" id="class-sensorperfperfeventwatcher"><h1>class sensor::perf::PerfEventWatcher</h1></a>
<p>This class is configuring and polling the values of the <code>perf_event</code>
being watch for a given cgroup. If no cgroup is configured
(<code>PerfEventWatcher::_cgroupPath == &quot;&quot;</code>), then system events are watched.</p>
<a class="header" href="./sensor/impl-perf-event.html#configuration" id="configuration"><h2>Configuration</h2></a>
<p>The configuration <code>PerfEventWatcher::configure</code> is made with a list of
event names (e.g. <code>RAPL_ENERGY_PKG</code>, <code>LLC_MISSES</code>, ...). Multiple
<code>perf_event</code> are grouped, so there is only one reading to
make. Perf_event watching for cgroup is made per cpu, as it is
impossible (apparently) for libperf to watch the event of multiple cpu
core for a cgroup in a single file descriptor. So there is one file
descriptor per cpu core, and this file descriptor is watching multiple
events at the same time.</p>
<p>Configuration uses utility functions
<code>PerfEventWatcher::findPerfEventAttrs</code>, that look up for the libpfm
attributes. Only available events are watched, meaning that a
<code>PerfEventWatcher</code> is working even if there are some undefined event
in the configuration. Undefined event are logged as errors.</p>
<a class="header" href="./sensor/impl-perf-event.html#polling-events" id="polling-events"><h2>Polling events</h2></a>
<p>The polling of event is made using the file descriptors opened during
the configuration.  There are two ways of polling events, with and
without cache. With cache is the prefered method
<code>PerfEventWatcher::poll (vector&lt;Metric&gt;&amp;)</code> as it does not reallocate
memory, and is therefore more efficient.</p>
<p>The polling reset the metric values, the content of the metric is the
number of events since the last poll.</p>
<a class="header" href="./sensor/impl-perf-event.html#disposing" id="disposing"><h2>Disposing</h2></a>
<p><code>PerfEventWatcher</code> opens many file descriptor that must be closed. For
that the class was written using the <code>move</code> semantic. Thus it is
impossible to <code>copy</code> a <code>PerfEventWatcher</code>, it must be moved <code>std::move (watcher)</code>. All disposing are made automatically by the destructor of
the instance that has the ownership.</p>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a rel="prev" href="./sensor/impl-notif.html" class="mobile-nav-chapters previous" title="Previous chapter">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="./sensor/impl-cgroup-lister.html" class="mobile-nav-chapters next" title="Next chapter">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="./sensor/impl-notif.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="./sensor/impl-cgroup-lister.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        
        <script type="text/javascript" src="custom.js"></script>
        

    </body>
</html>
